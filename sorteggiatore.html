<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üé≤ Sorteggiatore per Gruppi ‚Äî Standalone v5d</title>
  <style>
    :root{
      color-scheme: light;
      --bg1:#e6f0ff; --bg2:#eef2ff; --card:#fff; --text:#0f172a; --muted:#64748b;
      --pri:#4f46e5; --pri2:#4338ca; --ring:#6366f1; --pill:#eef2ff; --pillb:#c7d2fe;
      --indigo:#6366f1;
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Helvetica, Arial, sans-serif;
      background:linear-gradient(to bottom, var(--bg1), var(--bg2));
      color:var(--text);
    }
    .container{ max-width:1100px; margin:24px auto; padding:0 16px; }
    header{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:24px; }
    h1{ font-size: clamp(22px,3vw,34px); margin:0; font-weight:900; letter-spacing:-.02em; }
    .toolbar{ display:flex; gap:8px; flex-wrap:wrap; }
    .btn{
      padding:12px 16px; border-radius:18px; border:1px solid #e5e7eb; background:#fff;
      box-shadow:0 6px 16px rgba(0,0,0,.08); cursor:pointer; font-weight:700;
    }
    .btn.primary{ background:linear-gradient(135deg, var(--pri), var(--pri2)); color:#fff; border:none; }
    .btn:active{ transform:scale(.99); }
    .muted{ opacity:.6; }
    .grid{ display:grid; grid-template-columns: repeat(1, minmax(0,1fr)); gap:16px; }
    @media (min-width:860px){ .grid{ grid-template-columns: repeat(4, minmax(0,1fr)); } }
    .card{ background:var(--card); border-radius:22px; box-shadow:0 20px 50px rgba(2,6,23,.08); padding:16px; }
    label{ display:block; font-size:12px; color:var(--muted); margin-bottom:6px; font-weight:600; }
    input[type=number], textarea{
      width:100%; border:1px solid #d1d5db; border-radius:14px; padding:10px 12px; font-size:14px; outline:none;
      background:#fff; color:var(--text);
    }
    input[type=number]:focus, textarea:focus{ border-color:var(--ring); box-shadow:0 0 0 3px rgba(99,102,241,.25); }
    .hint{ font-size:12px; color:var(--muted); margin-top:6px; }
    .stage{
      position:relative; overflow:hidden; border-radius:28px; padding:24px; background:var(--card);
      box-shadow:0 30px 70px rgba(2,6,23,.12);
    }
    .stageBg{ position:absolute; inset:0; pointer-events:none; background-image:
      radial-gradient(circle at 20% 20%, rgba(99,102,241,0.09), transparent 40%),
      radial-gradient(circle at 80% 30%, rgba(56,189,248,0.10), transparent 35%),
      radial-gradient(circle at 50% 80%, rgba(16,185,129,0.09), transparent 45%); }
    .stageTitle{ text-align:center; font-size:12px; letter-spacing:.2em; text-transform:uppercase; color:var(--muted); margin:0 0 8px; }
    .slotWrap{ position:relative; margin:0 auto; max-width:900px; height:220px; display:flex; align-items:center; justify-content:center; }
    .slot{
      display:inline-block; white-space:nowrap; max-width:100%; overflow:hidden; text-overflow:ellipsis;
      font-weight:900; font-size: clamp(40px, 9vw, 88px); filter: drop-shadow(0 4px 8px rgba(2,6,23,.25));
      text-align:center; padding:0 16px;
    }
    body.present .slot{ font-size: clamp(56px, 12vw, 140px); }
    .progress{ height:10px; background:#f3f4f6; border-radius:999px; overflow:hidden; }
    .bar{ height:100%; background:#6366f1; width:0%; transition: width .25s ease; }
    .groups{ display:grid; grid-template-columns: repeat(1, minmax(0,1fr)); gap:16px; }
    @media (min-width:680px){ .groups{ grid-template-columns: repeat(2, minmax(0,1fr)); } }
    @media (min-width:1024px){ .groups{ grid-template-columns: repeat(4, minmax(0,1fr)); } }
    .pill{
      display:flex; align-items:center; justify-content:center; width:100%; padding:10px 12px; margin:6px 0;
      border-radius:14px; background:#eef2ff; border:1px solid #c7d2fe;
      font-weight:800; font-size:14px; white-space:normal; word-break:break-word;
      box-shadow:0 4px 10px rgba(79,70,229,.07);
    }
    .pop-in{ opacity:0; transform: scale(.6) translateY(-8px); animation: pop 420ms cubic-bezier(.2,.9,.2,1) forwards; }
    @keyframes pop { to{ opacity:1; transform: scale(1) translateY(0); } }
    footer{ text-align:center; font-size:12px; color:#64748b; margin:24px 0; }
    .note{ text-align:center; font-size:12px; color:#475569; margin-top:6px; }
    .disabled{ background:#f5f5f5; color:#9ca3af; border-color:#e5e7eb; }
    .exportBar{ display:none; gap:8px; flex-wrap:wrap; margin-top:16px; }
    .errorBox{ display:none; background:#fee2e2; color:#7f1d1d; border:1px solid #fecaca; padding:12px; border-radius:12px; margin-bottom:12px; }
    .errorBox strong{ color:#b91c1c; }
    body.present .panel { display:none !important; }
    #exitPresent { display:none; position:fixed; top:10px; right:10px; z-index:50; background:rgba(0,0,0,.6); color:#fff; border:none; border-radius:12px; padding:8px 12px; cursor:pointer; }
    body.present #exitPresent { display:block; }
  </style>
</head>
<body>
  <div class="container">
    <header class="panel">
      <h1>üé≤ Sorteggiatore per Gruppi ‚Äî Standalone v5d</h1>
      <div class="toolbar">
        <button id="presentBtn" class="btn primary">‚õ∂ Presenta</button>
        <button id="muteBtn" class="btn">üîä Audio</button>
        <button id="resetBtn" class="btn">‚ü≤ Reset</button>
        <button id="startBtn" class="btn">‚ñ∂ Avvia sorteggio</button>
      </div>
    </header>

    <button id="exitPresent" title="Esci presentazione">‚§¢ Esci presentazione</button>

    <div id="errorBox" class="errorBox panel"></div>

    <section class="grid panel">
      <div class="card">
        <label>Quanti sono gli studenti?</label>
        <input id="studentsInput" type="number" min="1" value="24" />
        <div id="studentsHint" class="hint">Verranno numerati da 1 a 24.</div>
      </div>

      <div class="card">
        <label>Quanti gruppi vuoi formare?</label>
        <input id="groupsInput" type="number" min="1" value="4" />
        <div id="groupsInfo" class="hint">Attivo (usa questo oppure il campo a destra)</div>
      </div>

      <div class="card">
        <label>Quanti studenti per gruppo? (opzionale)</label>
        <input id="perGroupInput" type="number" min="0" value="0" />
        <div class="hint">Lascia 0 per usare il numero di gruppi.</div>
      </div>

      <div class="card">
        <label>Nomi degli studenti (opzionale)</label>
        <textarea id="namesArea" rows="6" placeholder="Es.:
Mario Rossi
Giulia Bianchi
...
oppure: Mario Rossi, Giulia Bianchi; Luca Verdi"></textarea>
        <div id="namesInfo" class="hint" style="display:none;"></div>
      </div>
    </section>

    <section class="stage" style="margin-top:16px;">
      <div class="stageBg"></div>
      <p id="displayLabel" class="stageTitle">Numero estratto</p>
      <div class="slotWrap">
        <div id="slotBox" class="slot">1</div>
      </div>
      <div style="text-align:center; font-size:14px; color:#475569;">
        Estratti: <span id="revealedCount">0</span> / <span id="baseCount">24</span>
      </div>
      <div class="progress" style="margin-top:12px;">
        <div id="progress" class="bar"></div>
      </div>
      <p id="evenness" class="note"></p>
    </section>

    <section id="groupsGrid" class="groups" style="margin-top:16px;"></section>

    <div id="exportBar" class="exportBar">
      <button id="exportCsvBtn" class="btn primary">‚¨áÔ∏è Esporta CSV</button>
      <button id="exportTxtBtn" class="btn">‚¨áÔ∏è Esporta TXT</button>
      <span class="hint">Il CSV usa il punto e virgola come separatore.</span>
    </div>

    <footer class="panel">Consiglio: schermo intero (F11) per l'effetto scenografico ‚ú®</footer>
  </div>

<script>
(function(){
  const errorBox = document.getElementById('errorBox');
  window.addEventListener('error', (ev) => {
    errorBox.style.display='block';
    errorBox.innerHTML = '<strong>Errore JS:</strong> ' + (ev.message || ev.error || 'sconosciuto');
  });

  class AudioEngine {
    constructor(){ this.ctx=null; this.master=null; this.wheelOsc=null; this.wheelGain=null; this.lfo=null; this.lfoGain=null; this.muted=false; }
    ensureContext(){ if(this.ctx) return; const AC=window.AudioContext||window.webkitAudioContext; if(!AC) return;
      const ctx=new AC(); this.ctx=ctx; this.master=ctx.createGain(); this.master.gain.value=.2; this.master.connect(ctx.destination); }
    async resume(){ this.ensureContext(); if(this.ctx && this.ctx.state==='suspended'){ try{ await this.ctx.resume(); }catch(e){} } }
    startWheel(){ if(this.muted) return; this.ensureContext(); if(!this.ctx||this.wheelOsc) return; const ctx=this.ctx;
      const osc=ctx.createOscillator(); osc.type='sawtooth'; osc.frequency.value=140;
      const gain=ctx.createGain(); gain.gain.value=0; osc.connect(gain); gain.connect(this.master);
      const lfo=ctx.createOscillator(); lfo.frequency.value=6; const lfoGain=ctx.createGain(); lfoGain.gain.value=0.02; lfo.connect(lfoGain); lfoGain.connect(gain.gain);
      osc.start(); lfo.start(); gain.gain.linearRampToValueAtTime(0.03, ctx.currentTime+.2);
      this.wheelOsc=osc; this.wheelGain=gain; this.lfo=lfo; this.lfoGain=lfoGain; }
    stopWheel(){ if(!this.ctx||!this.wheelOsc) return; const ctx=this.ctx; try{ this.wheelGain.gain.cancelScheduledValues(ctx.currentTime); this.wheelGain.gain.linearRampToValueAtTime(0, ctx.currentTime+.15);}catch(e){}
      const o=this.wheelOsc, l=this.lfo; setTimeout(()=>{ try{o.stop()}catch(e){} try{l.stop()}catch(e){} this.wheelOsc=null; this.wheelGain=null; this.lfo=null; this.lfoGain=null; },220); }
    beep(){ if(this.muted) return; this.ensureContext(); if(!this.ctx) return; const ctx=this.ctx, osc=ctx.createOscillator(); osc.type='sine'; osc.frequency.value=880;
      const gain=ctx.createGain(); gain.gain.value=0; osc.connect(gain); gain.connect(this.master); const t=ctx.currentTime; osc.start(t);
      gain.gain.setValueAtTime(0,t); gain.gain.linearRampToValueAtTime(.25,t+.01); gain.gain.linearRampToValueAtTime(0,t+.16); osc.stop(t+.2); }
    tada(){ if(this.muted) return; this.ensureContext(); if(!this.ctx) return; const ctx=this.ctx, freqs=[523.25,659.25,783.99];
      freqs.forEach((f,i)=>{ const osc=ctx.createOscillator(); osc.type='triangle'; osc.frequency.value=f; const gain=ctx.createGain(); gain.gain.value=0; osc.connect(gain); gain.connect(this.master);
        const t0=ctx.currentTime+i*.06; osc.start(t0); gain.gain.setValueAtTime(0,t0); gain.gain.linearRampToValueAtTime(.28,t0+.08); gain.gain.linearRampToValueAtTime(0,t0+.5); osc.stop(t0+.55); }); }
    setMuted(m){ this.muted=m; }
  }

  // Robust name parsing:
  // - split on CR (\r), LF (\n), TAB, comma, semicolon, Unicode NEL/LS/PS
  // - keep spaces INSIDE names ("Mario Rossi")
  function parseNames(text){
    return String(text || '')
      .replace(/\u00A0/g, ' ') // NBSP -> space
      .split(/[\r\n,;\t\u0085\u2028\u2029]+/)
      .map(s => s.trim())
      .filter(s => s.length > 0);
  }

  const studentsInput = document.getElementById('studentsInput');
  const groupsInput   = document.getElementById('groupsInput');
  const perGroupInput = document.getElementById('perGroupInput');
  const groupsInfo    = document.getElementById('groupsInfo');
  const namesArea     = document.getElementById('namesArea');
  const namesInfo     = document.getElementById('namesInfo');
  const muteBtn       = document.getElementById('muteBtn');
  const resetBtn      = document.getElementById('resetBtn');
  const startBtn      = document.getElementById('startBtn');
  const presentBtn    = document.getElementById('presentBtn');
  const exitPresent   = document.getElementById('exitPresent');
  const slotBox       = document.getElementById('slotBox');
  const displayLabel  = document.getElementById('displayLabel');
  const progressEl    = document.getElementById('progress');
  const revealedEl    = document.getElementById('revealedCount');
  const baseCountEl   = document.getElementById('baseCount');
  const groupsGrid    = document.getElementById('groupsGrid');
  const evennessEl    = document.getElementById('evenness');
  const studentsHint  = document.getElementById('studentsHint');
  const exportBar     = document.getElementById('exportBar');
  const exportCsvBtn  = document.getElementById('exportCsvBtn');
  const exportTxtBtn  = document.getElementById('exportTxtBtn');

  const audio = new AudioEngine();
  let baseCount=24, usingNames=false, names=[], isRolling=false;
  let rollingInterval=null, revealTimer=null, sequence=[], groups=[], revealedCount=0;
  let lastAdded = { gi: -1, idx: -1 };

  function labelFor(i){ return usingNames ? names[i-1] : String(i); }
  function toIntOr(def, s){ const v = parseInt(s, 10); return Number.isFinite(v) ? v : def; }
  function calcEffectiveGroups(){
    const perGroupRaw = toIntOr(0, perGroupInput.value);
    const gInputRaw   = toIntOr(1, groupsInput.value);
    const cleanPerGroup = Math.max(0, perGroupRaw|0);
    const cleanNumGroups = Math.max(1, gInputRaw|0);
    const active = cleanPerGroup > 0;
    const g = active ? Math.ceil(Math.max(1, baseCount)/Math.max(1, cleanPerGroup)) : cleanNumGroups;
    return { active, g, cleanPerGroup, cleanNumGroups };
  }
  function updateEvenness(){
    const {active,g} = calcEffectiveGroups();
    const q = Math.floor(baseCount/g), r = baseCount % g;
    const parts=[]; if(q>0) parts.push(q+' per gruppo'); if(r>0) parts.push('+ '+r+' extra totali');
    evennessEl.textContent = parts.join(' ') + (active ? ' (modalit√†: studenti per gruppo)' : ' (modalit√†: numero gruppi)');
    groupsInput.disabled = active;
    groupsInput.classList.toggle('disabled', active);
    groupsInfo.textContent = active ? "Disabilitato: stai usando 'studenti per gruppo'" : "Attivo (usa questo oppure il campo a destra)";
  }
  function renderGroups(){
    const {g} = calcEffectiveGroups();
    groupsGrid.innerHTML='';
    for(let gi=0; gi<g; gi++){
      const card=document.createElement('div'); card.className='card';
      const header=document.createElement('div'); header.style.display='flex'; header.style.justifyContent='space-between'; header.style.marginBottom='8px'; header.style.alignItems='center';
      header.innerHTML='<h3 style="font-weight:900; font-size:18px; margin:0">Gruppo '+(gi+1)+'</h3><span class="hint">'+((groups[gi]||[]).length)+' membri</span>';
      const body=document.createElement('div'); body.style.minHeight='84px'; body.dataset.gi = String(gi);
      const list=groups[gi]||[];
      list.forEach(idx=>{ const pill=document.createElement('div'); pill.className='pill'+(lastAdded.gi===gi && lastAdded.idx===idx ? ' pop-in':'' ); pill.title=usingNames?labelFor(idx):('Studente #'+idx); pill.textContent=labelFor(idx); body.appendChild(pill); });
      if(list.length===0){ const p=document.createElement('p'); p.className='hint'; p.textContent='In attesa di estrazioni‚Ä¶'; body.appendChild(p); }
      card.appendChild(header); card.appendChild(body); groupsGrid.appendChild(card);
    }
  }
  function resetAll(){
    isRolling=false; clearInterval(rollingInterval); rollingInterval=null; clearTimeout(revealTimer); revealTimer=null;
    audio.stopWheel(); revealedCount=0; sequence=[]; groups=[]; lastAdded={gi:-1, idx:-1};
    slotBox.textContent = usingNames ? (names[0]||'‚Äî') : '1';
    progressEl.style.width='0%'; revealedEl.textContent='0';
    exportBar.style.display='none';
    renderGroups();
  }
  function recomputeBaseCount(){
    names = parseNames(namesArea.value); usingNames = names.length>0;
    if(usingNames){
      baseCount = names.length; studentsInput.value = baseCount; studentsInput.disabled=true;
      studentsInput.classList.add('disabled');
      namesInfo.style.display='block'; namesInfo.innerHTML='User√≤ i <strong>'+baseCount+'</strong> nomi inseriti. Se svuoti il riquadro, torneranno i numeri.';
      displayLabel.textContent='Nome estratto';
    } else {
      baseCount = Math.max(1, toIntOr(1, studentsInput.value)); studentsInput.disabled=false;
      studentsInput.classList.remove('disabled');
      namesInfo.style.display='none'; displayLabel.textContent='Numero estratto';
    }
    baseCountEl.textContent=String(baseCount);
    studentsHint.textContent='Verranno numerati da 1 a '+baseCount+'.';
    updateEvenness(); resetAll();
  }

  async function enterPresent(){
    document.body.classList.add('present');
    try{ const el=document.documentElement; if(el.requestFullscreen) await el.requestFullscreen(); }catch(e){}
  }
  async function exitPresentMode(){
    document.body.classList.remove('present');
    try{ if(document.fullscreenElement && document.exitFullscreen) await document.exitFullscreen(); }catch(e){}
  }

  function animateSlot(toText){
    slotBox.textContent = toText;
    slotBox.animate([
      { transform:'translateY(-80px) scale(0.92)', opacity:0 },
      { transform:'translateY(0) scale(1)', opacity:1 }
    ],{ duration:420, easing:'cubic-bezier(.2,.9,.2,1)' });
  }

  function sanitizeCsvCell(value){
    const s = String(value ?? '');
    return /^[=+\-@]/.test(s) ? "'" + s : s;
  }
  function buildRows(){
    const rows = [["Gruppo","Ordine","Indice","Etichetta"]];
    groups.forEach((gList, gi)=>{
      gList.forEach((idx, pos)=>{
        rows.push([`Gruppo ${gi+1}`, String(pos+1), String(idx), String(labelFor(idx))]);
      });
    });
    return rows;
  }
  function tryDownload(text, mime, name){
    try{
      const blob = new Blob([text], {type:mime});
      const a = document.createElement('a');
      const url = URL.createObjectURL(blob);
      a.href = url; a.download = name; a.rel='noopener'; document.body.appendChild(a); a.click();
      setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); },0);
    }catch(e1){
      try{
        const a=document.createElement('a');
        a.href = `data:${mime};charset=utf-8,` + encodeURIComponent(text);
        a.download = name; a.rel='noopener'; document.body.appendChild(a); a.click();
        setTimeout(()=>a.remove(),0);
      }catch(e2){
        alert('Download non consentito da questo browser. Copia il testo mostrato e incollalo in un file.');
        const w = window.open('', '_blank'); if(w){ w.document.write('<pre>'+String(text).replace(/[&<>]/g, s=>({"&":"&amp;","<":"&lt;",">":"&gt;"}[s]))+'</pre>'); w.document.close(); }
      }
    }
  }
  function exportCSV(){
    const rows=buildRows();
    const csv=rows.map(r=>r.map(c=>`"${String(sanitizeCsvCell(c)).replace(/"/g,'""')}"`).join(';')).join('\n');
    tryDownload(csv,'text/csv','suddivisione_gruppi.csv');
  }
  function exportTXT(){
    const lines=[];
    groups.forEach((gList,gi)=>{
      lines.push(`**Gruppo ${gi+1}**`);
      gList.forEach((idx,pos)=>lines.push(`${pos+1}. ${labelFor(idx)}${usingNames?'':` (studente #${idx})`}`));
      lines.push('');
    });
    tryDownload(lines.join('\n'),'text/plain','suddivisione_gruppi.txt');
  }

  namesArea.addEventListener('input', recomputeBaseCount);
  namesArea.addEventListener('paste', ()=> setTimeout(recomputeBaseCount, 0));

  studentsInput.addEventListener('input', ()=>{
    if(!usingNames){
      baseCount=Math.max(1, toIntOr(baseCount, studentsInput.value));
      baseCountEl.textContent=String(baseCount);
      studentsHint.textContent='Verranno numerati da 1 a '+baseCount+'.';
      updateEvenness(); resetAll();
    }
  });
  groupsInput.addEventListener('input', ()=>{ updateEvenness(); renderGroups(); });
  perGroupInput.addEventListener('input', ()=>{ updateEvenness(); renderGroups(); });

  resetBtn.addEventListener('click', resetAll);
  muteBtn.addEventListener('click', ()=>{
    audio.muted = !audio.muted;
    muteBtn.textContent = audio.muted ? 'üîá Muto' : 'üîä Audio';
    muteBtn.classList.toggle('muted', audio.muted);
  });

  exportCsvBtn.addEventListener('click', exportCSV);
  exportTxtBtn.addEventListener('click', exportTXT);

  presentBtn.addEventListener('click', enterPresent);
  exitPresent.addEventListener('click', exitPresentMode);

  startBtn.addEventListener('click', async ()=>{
    try{
      await audio.resume();
      // Ensure latest textarea content is parsed before starting
      recomputeBaseCount();

      const {active, g, cleanPerGroup, cleanNumGroups} = calcEffectiveGroups();
      if(active){ if(cleanPerGroup<=0){ alert("Inserisci un numero valido nel campo 'Quanti studenti per gruppo?'"); return; } }
      else{ if(cleanNumGroups<=0){ alert("Inserisci un numero di gruppi valido oppure usa 'studenti per gruppo'."); return; } }
      if(!usingNames){
        const n = Math.max(1, toIntOr(0, studentsInput.value));
        if(!Number.isInteger(n) || n<=0){ alert('Inserisci un numero di studenti valido o incolla una lista di nomi.'); return; }
        baseCount = n; baseCountEl.textContent=String(baseCount);
      }
      if(g > baseCount){ if(!confirm('Ci sono pi√π gruppi che studenti. Continuo lo stesso?')) return; }

      const studentsList = Array.from({length: baseCount}, (_,i)=>i+1);
      sequence = (function shuffle(a){ const x=a.slice(); for(let i=x.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [x[i],x[j]]=[x[j],x[i]]; } return x; })(studentsList);
      groups = Array.from({length: g}, ()=>[]);
      revealedCount = 0; lastAdded={gi:-1, idx:-1}; renderGroups();

      exportBar.style.display='none';

      isRolling=true; clearInterval(rollingInterval);
      audio.startWheel();
      rollingInterval=setInterval(()=>{
        const rnd = Math.max(1, Math.floor(Math.random()*baseCount)+1);
        slotBox.textContent = labelFor(rnd);
      }, 50);

      const baseDelay=900;
      function revealStep(index){
        if(index >= sequence.length){
          isRolling=false; clearInterval(rollingInterval); audio.stopWheel(); audio.tada();
          exportBar.style.display='flex';
          return;
        }
        const chosen = sequence[index];
        slotBox.textContent = labelFor(chosen);
        const gIndex = index % g; groups[gIndex].push(chosen); lastAdded={gi:gIndex, idx:chosen};
        revealedCount = index+1; revealedEl.textContent = String(revealedCount);
        progressEl.style.width = Math.min(100, (revealedCount/baseCount)*100) + '%';
        renderGroups();
        audio.beep();
        revealTimer = setTimeout(()=>revealStep(index+1), baseDelay);
      }
      clearTimeout(revealTimer);
      revealTimer = setTimeout(()=>revealStep(0), 800);
    }catch(err){
      errorBox.style.display='block';
      errorBox.innerHTML = '<strong>Errore:</strong> ' + (err && err.message ? err.message : String(err));
    }
  });

  (function bootstrap(){
    baseCountEl.textContent=String(baseCount);
    studentsHint.textContent='Verranno numerati da 1 a '+baseCount+'.';
    updateEvenness(); recomputeBaseCount();
  })();
})();
</script>
</body>
</html>
